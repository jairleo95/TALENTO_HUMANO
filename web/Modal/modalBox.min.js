(function(a,b,c){function d(){a.console&&console.log(arguments)}if(!Object.keys){Object.keys=function(a){var b=[],c;for(c in a){b.push(c)}return b}}var e=/*@cc_on ! @*/!1;var f=e&&(9<b.documentMode||b.documentMode===c),g={easeInQuad:function(a,b,c,d){return c+b*(a/=d)*a}},h=function(b){return a.getComputedStyle?a.getComputedStyle(b,null):b.currentStyle},j=function(a,b,d,e,f){var g=this,i=h(a).display;if(e&&typeof e==="function"){f=e;e=c}for(var j in b){j===Object.keys(b)[0]?k(a,j,b[j],d,e,f):k(a,j,b[j],d,e)}},k=function(a,b,c,d,e,j){function r(){var c=e(m,p,n,l);if(b==="opacity"){!f?a.style[b]=c:a.style.filter="alpha(opacity="+100*c+")"}else{a.style[b]=c+o}m++}function s(){clearTimeout(q);a.style[b]=c+o;if(j&&typeof j==="function")j.apply(a,arguments)}var k=60,l=k*d/1e3,m=i=1,n=h(a)[b],o=b==="opacity"?"":"px",p,q;n=isNaN(parseFloat(n))?0:parseFloat(n);if(/height|width/.test(b)){a.style.overflowX=a.style.overflowY="hidden"}e=g[e]||g.easeInQuad;p=c-n;if(b!=="opacity"){a.style[b]=n+o}else{!f?a.style[b]=n:a.style.filter="alpha(opacity="+100*n+")"}for(;i<=l;i++){q=setTimeout(r,d/l*i)}setTimeout(s,d)},l=function(){m(arguments,function(a){a.parentNode&&a.parentNode.removeChild(a)})},m=function(a,b){for(var c=0,d=a.length;c<d;c++){b.call(null,a[c],c)}},n=b.body,o=function(){return{scrollTop:a.pageYOffset||b.documentElement.scrollTop,scrollLeft:a.pageXOffset||b.documentElement.scrollLeft,width:a.innerWidth||b.documentElement.clientWidth,height:a.innerHeight||b.documentElement.clientHeight}},p=function(a,c){var d=b.createElement(a);if(c){if(typeof c==="string"){d.id=c}else{for(var e in c){if(e==="style"){for(var f in c[e]){d.style[f]=c[e][f]}}else{d.setAttribute(e,c[e])}}}}return d},q=function(b,c,d){b.addEventListener?b.addEventListener(c,d,false):b.attachEvent("on"+c,function(c){if(!c){c=a.event}if(!c.preventDefault){c.preventDefault=function(){this.returnValue=false};c.stopPropagation=function(){this.cancelBubble=true}}d.call(b,c)})},r=function(a,b,c){if(a.length){m(a,function(a){q(a,b,c)})}else{q(a,b,c)}},s=function(a,c,d,e){var f=b.getElementsByTagName(a),g=new RegExp(c||"",d),h=[];m(f,function(a){if(g.test(a.getAttribute(e)||""))h.push(a)});return h},t=function(a){var d,e=o(),f,g;if(/^#[^\/\s]+$/i.test(a)){d=p("div");d.style.width=modalBox.config.inlineWidth+"px";d.innerHTML=b.getElementById(a.substring(1)).innerHTML}else if(/youtube\.com(\/v\/|.*watch\?v)/.test(a)||/vimeo\./.test(a)){d=p("iframe",{src:/vimeo\./.test(a)?"http://player.vimeo.com/video/"+a.substring(a.lastIndexOf("/")+1):"http://www.youtube.com/embed/"+a.substring(a.indexOf("watch?v=")===-1?a.indexOf("/v/")+3:a.indexOf("watch?v=")+8,a.indexOf("/v/")!==-1?a.indexOf("?")===-1?c:a.indexOf("?"):a.indexOf("&")!==-1?a.indexOf("&"):c)+"?autoplay=1",type:"text/html",width:"640",height:"390",frameborder:"0",allowtransparency:"true"})}else if(/\.(png|jpe?g|gif)$/i.test(a)){d=p("img")}else if(/(\?|&)iframe=true/.test(a)){f=a.match(/(\?|&)width=([0-9]+%?)(&|$)/);g=a.match(/(\?|&)height=([0-9]+%?)(&|$)/);d=p("iframe",{src:a.replace(/(\?|&)(height|width|iframe)=(true|[0-9]+%?)/g,""),width:f!==null?/%$/.test(f[2])?parseFloat(f[2])*e.width/100:f[2]:e.width*.7,height:g!==null?/%$/.test(g[2])?parseFloat(g[2])*e.height/100:g[2]:e.height*.7,frameborder:"0",allowtransparency:"true"})}return d},u={getAttribute:function(){return""}},v=function(a){if(e){return a.getAttribute("href",2)}return a.getAttribute("href")};a.modalBox={config:{overlayClick:true,showNavi:true,showGalName:true,inlineWidth:600,orden:["title","content","caption","navi"],textoAnterior:"Anterior",textoSiguiente:"Siguiente",textoCerrar:"X",atributo:"rel"},init:function(b,c,d){var e=arguments.length===1,f=a.jQuery&&e?jQuery(b).get():a.Sizzle&&e?Sizzle(b):s(b,c,d,this.config.atributo);this.els=this.els?this.els.concat(f):f;this.eventos();return this},eventos:function(){var a=this;m(this.els,function(b,c){r(b,"click",function(b){a.createGallery(this,c);a.loadModal();b.preventDefault();b.stopPropagation()})});return this},createGallery:function(a,b){var c=this,d=/\[(.*)\]/,e=a.getAttribute(this.config.atributo).match(d),f=[];if(e===null){this.currentGallery=this.els;this.currentElFromGal=b;this.inGallery=this.galName=false;return false}m(this.els,function(b,g){var h=b.getAttribute(c.config.atributo);d.test(h)&&h.match(d)[0]===e[0]&&f.push(b);if(b===a)c.currentElFromGal=f.length-1});this.currentGallery=f;this.galName=e[1];this.inGallery=true;return false},loadModal:function(a,b){var c=this,d=!a?this.currentGallery[this.currentElFromGal]:u,e,f;!this.modal&&this.createMarkup();this.modal.className=this.modal.className.replace("cargado","");var g=b&&a?b:v(d);m(this.config.orden,function(b){b=="navi"?c.setNavi():b=="title"?c.setTitle(a):b=="caption"?c.setCaption(a):c.setContent(t(g), g)});e=this.mainEl;e.tagName!=="IMG"&&this.setDimensions()},trigger:function(a){this.loadModal(true,a)},setTitle:function(a){this.title&&l(this.title);var b=!a?this.currentGallery[this.currentElFromGal]:u,c=this.title=p("div",{id:"modal-title","class":"title"}),d=b.title||b.getAttribute("data-title");c.innerHTML=d||"";this.modal.appendChild(c)},setCaption:function(a){this.caption&&l(this.caption);var b=!a?this.currentGallery[this.currentElFromGal]:u,c=this.caption=p("div",{id:"modal-caption","class":"caption"}),d=b.alt||b.getAttribute("data-caption");c.innerHTML=d||"";this.modal.appendChild(c)},setNavi:function(){this.navi&&l(this.navi);var a=this,b=a.config,c=a.navi=p("div",{id:"modal-navi","class":"navi"}),d=p("a",{id:"modal-next","class":"next"}),e=p("a",{id:"modal-prev","class":"prev"}),f=p("a",{id:"modal-close","class":"close"}),g=p("div");g.style.clear="both";d.href=e.href=f.href="#";d.setAttribute("data-dir","next");e.setAttribute("data-dir","prev");d.innerHTML=b.textoSiguiente;e.innerHTML=b.textoAnterior;f.innerHTML=b.textoCerrar;r([d,e],"click",function(b){if(this.getAttribute("data-dir")==="next"){a.currentElFromGal+=1}else{a.currentElFromGal-=1}a.loadModal();b.preventDefault()});r(f,"click",function(b){a.close();b.preventDefault()});if(a.inGallery){if(b.showNavi&&a.currentElFromGal!==0){c.appendChild(e)}if(b.showNavi&&a.currentElFromGal!==this.currentGallery.length-1){c.appendChild(d)}}c.appendChild(f);c.appendChild(g);this.modal.appendChild(c)},setContent:function(a,b){this.content&&l(this.content);var c=this,e=o(),g=this.content=p("div",{id:"modal-content","class":"content"});if(a.tagName==="IMG"){dummy=p("div",{style:{visibility:"hidden",position:"absolute",top:"-9999px",left:"-9999px",zIndex:"-999"},id:"dummy"});n.appendChild(dummy);dummy.appendChild(a);imageOnLoad=function(){d("Evento ejecutado en imagen");var b={width:a.offsetWidth,height:a.offsetHeight},h=false,i;d(b.width,b.height);if(b.height>e.height){a.height=e.height*.7;a.width=a.height*b.width/b.height;h=true}else if(b.width>e.width){a.width=e.width*.7;a.height=a.width*b.height/b.width;h=true}if(h){i=p("a",{href:"javascript:;","class":"modal-resize"});i.innerHTML="+";r(i,"click",function(b){a.style.visibility="hidden";a.removeAttribute("width");a.removeAttribute("height");c.setDimensions();b.preventDefault()});c.navi?c.navi.insertBefore(i,c.navi.lastChild):setTimeout(function(){c.navi.insertBefore(i,c.navi.lastChild)},1e3)}g.appendChild(a);l(dummy);c.setDimensions();f&&a.detachEvent("onload",imageOnLoad)};r(a,"load",imageOnLoad);a.src=b}this.modal.appendChild(g);a.tagName==="IFRAME"&&(a.style.visibility="hidden");a.tagName!=="IMG"&&g.appendChild(a);!this.visible&&this.show();this.mainEl=a},show:function(){n.appendChild(this.modal);n.appendChild(this.overlay);this.visible=true},close:function(){m(this.content.children,function(a){a.style&&(a.style.display="none");l(a)});l(this.modal);j(this.overlay,{opacity:0},600,function(){l(this)});this.inGallery=false;this.visible=false;this.overlay=this.modal=c},createMarkup:function(){var a=this,b=o(),c;this.overlay=p("div","modal-overlay");this.modal=p("div","modalBox");c=this.modal.style;c.width=c.height="30px";c.bottom=c.right="auto";c.top=b.scrollTop+b.height/2+"px";c.left=b.width/2+"px";c.marginTop=c.marginLeft="-15px";if(this.config.overlayClick){this.overlay.onclick=function(){a.close()}}},setDimensions:function(){var a=this,b=this.modal,c=h(b),d=this.mainEl,e=this.modal.style,f=d.offsetHeight,g=d.offsetWidth;j(b,{width:g,marginLeft:-g/2-parseInt(c.paddingLeft,10),opacity:1},600,function(){m([a.navi,a.title,a.caption],function(a){var b=h(a);b.position!=="absolute"&&(b["cssFloat"]||b["float"])==="none"&&(f+=a.offsetHeight)});j(b,{height:f,marginTop:-f/2-parseInt(c.paddingTop,10)},600,function(){e.overflowX=e.overflowY=a.mainEl.style.visibility="visible";b.className+=" cargado"})})}}})(window,document);
